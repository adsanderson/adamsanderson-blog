<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>A critical fix</title><meta name="description" content="or: How I used critcal path CSS to help speed up loading"><link rel="stylesheet" type="text/css" href="/static/css/style.css"><link rel="stylesheet" type="text/css" href="/static/css/prism-tomorrow.css"></head><body><div class="container max-w-4xl mt-6 px-6"><div class="pb-5 mb-5 border-b border-gray-100"><h1 class="font-bold text-5xl">A critical fix</h1><p class="text-center text-base leading-6 font-medium text-gray-500"><time>08 Jun 2016 by <a></a></time></p></div><article class="prose lg:prose-xl my-4 mx-auto"><p>A look into how I fixed an issue with a less than optimal optimisation, or how I got critical, phantomjs, SVGs and responsiveness to play together.</p><h3>The background &amp; the problem</h3><p>I've add <a href="https://github.com/addyosmani/critical">critical</a> into this blogs build pipeline. Critical's job is to generate the critical CSS for each page and then inline it.</p><p>The problem was I was getting a pop-in with the css, un-styled content at the bottom of the screen. This felt like a step back from loading the full stylesheet.</p><p><img src="/images/popin-timeline.png" alt="The loading timeline with pop-in"></p><h3>The debug process</h3><p>The first stop in the process to track down the issue was to check what CSS was being inlined. This was simply looking at the generated <code>&lt;style&gt;</code> tag in the head of the document. It was obvious that the <code>.nav</code> section of rules were missing.</p><p>So we know the issue is with the generation; and only some of the expected rules being generated.</p><p>My next target for inspection was the SVG title in the header. It seems the rules after that were not being generated. So I deleted the SVG re-ran the generation and found that had fixed the missing CSS rules.</p><h3>A picture is worth a thousand words</h3><p>The next step was to see what was being generated inside of critical to get this unwanted result. So I wrote a simple phantomjs script to take render the page and see what it looked like.</p><script src="https://gist.github.com/adsanderson/f2b857633b0ae930f83514334e62fbd2.js"></script><p>The results were surprising.</p><p><img src="/images/zoomed-out.png" alt="Large orange page"></p><p>I wanted the text in the heading to be responsive. The problem is without bounds that heading SVG got <strong>BIG</strong>. The above screenshot is <code>10000px</code> high, so with that critical was getting all of the above the fold content.</p><h3>The fix</h3><p>I added bounds, simply set the <code>max-height</code> for the SVG's container element and re-ran the generation to get this.</p><p><img src="/images/the-working-generation.png" alt="the working phantom render"></p><p>So now the page loads the critical CSS inline then the rest of the page loads. Without any visible pop-in.</p></article></div><footer><nav><div><div><img src="https://www.gravatar.com/avatar/7b1630c267230ec687dd7133d3a2e2b3?s=80" class="logo__img" alt="Adam Sanderson"></div>A front-end developer based out of Hastings, UK</div><a href="/">Home<a href="https://github.com/adsanderson" title="Github"> github </a><a href="https://twitter.com/lazydayed" title="Twitter">twitter </a><a href="mailto:adam+site@adamsanderson.co.uk" rel="me">email</a></a></nav></footer><script src="/static/js/alpine.js"></script></body></html>